{% extends "base.html" %}

{% block title %}Stats{% endblock %}

{% block content %}
  <div class="container mt-5 text-center">
    <h1>BMI Calculator Results</h1>

    {% if bmi is not none %}
      <div class="alert alert-success">
        <div style="padding-bottom: 0%; font-size: 16pt;">
          <strong>Your BMI: </strong> {{ bmi }}
          <span class="tooltip-asterisk">*</span>
          <span class="tooltip-text">BMI is an approximate estimate of your physical fitness...</span>
        </div>

        {% include "bmi_visual.html" %}

        <hr width="100%" size="2">

        <div style="padding-bottom: 2%; font-size: 16pt;">
          <strong>RECOMMENDED DAILY</strong>
        </div>

        {% if calories %}
          <div>
            <strong>Calories: </strong> {{ calories }} kcal
          </div>
        {% endif %}

        {% if protein is not none %}
          <div>
            <strong>Protein: </strong> {{ protein }} grams/day
          </div>
        {% endif %}

        {% if fat %}
          <div>
            <strong>Fat: </strong> {{ fat }} grams/day
          </div>
        {% endif %}

        {% if carbs %}
          <div>
            <strong>Carbs: </strong> {{ carbs }} grams/day
          </div>
        {% endif %}

        {% if water_intake %}
          <div>
            <strong>Water: </strong> {{ water_intake }} liter/day
          </div>
        {% endif %}

        <div class="mt-3">
          <h6 style="font-size: 0.8em;">That's about this many glasses of water:</h6>
          <div style="display: flex; flex-wrap: wrap; justify-content: left; width: 100%; margin-top: -3px; margin-bottom: -5px;">
            {% set glasses_count = (water_intake / 0.25) | round(0, 'ceil') | int %}
            {% for i in range(glasses_count) %}
              <div style="width: 12.5%; display: flex; justify-content: center; margin-top: -12px;">
                <img src="{{ url_for('static', filename='glassofwater_color.png') }}" alt="Glass" style="width: 60px; height: 55px;">
              </div>
            {% endfor %}
          </div>
          <p class="text-muted" style="font-size: 0.6em; font-style: italic;">
            (each glass represents 0.25 liters of water)
          </p>
        </div>
      </div>

      {% if protein and fat and carbs %}
        <div class="mt-5" style="max-width: 500px; margin: auto;">
          <h5 class="text-center">Macronutrient Distribution</h5>
          <canvas id="macroChart"></canvas>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
          const ctx = document.getElementById('macroChart').getContext('2d');
          const macroChart = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: ['Protein', 'Fat', 'Carbs'],
              datasets: [{
                data: [{{ protein }}, {{ fat }}, {{ carbs }}],
                backgroundColor: ['#4caf50', '#ff9800', '#2196f3'],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'bottom'
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      let value = context.raw;
                      return `${context.label}: ${value}g`;
                    }
                  }
                }
              }
            }
          });
        </script>
      {% endif %}
    {% endif %}

    {% if meal_plan %}
      <div class="alert alert-success">
        <h2>Suggested Meal Split</h2>
        <table class="table">
          <thead>
            <tr>
              <th>Meal</th>
              <th>Calories</th>
              <th>Protein (g)</th>
              <th>Fat (g)</th>
              <th>Carbs (g)</th>
            </tr>
          </thead>
          <tbody>
            {% for meal, macros in meal_plan.items() %}
              <tr>
                <td>{{ meal }}</td>
                <td>{{ macros.calories }}</td>
                <td>{{ macros.protein }}</td>
                <td>{{ macros.fat }}</td>
                <td>{{ macros.carbs }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
{% endblock %}
