{% extends "base.html" %}
{% block title %} Stats {% endblock %}
{% block content %}

<style>
  .tooltip-asterisk {
    display: inline-block;
    position: relative;
    color: #888;
    cursor: help;
    margin-left: 4px;
  }

  .tooltip-asterisk:hover + .tooltip-text {
    display: inline-block;
  }

  .tooltip-text {
    display: none;
    position: absolute;
    background-color: #333;
    color: #fff;
    padding: 6px 10px;
    border-radius: 5px;
    top: -5px;
    left: 20px;
    z-index: 1000;
    font-size: 0.85rem;
    white-space: normal;     
    max-width: 250px;        
    text-align: left;        
  }
</style>

<body style="background-color: #f7e5c1;">
  <div class="container mt-5" style="text-align: center;">
    <div class="position-relative text-center" style="display: inline-block;">

      {% if bmi is not none %}
        <div class="container mt-5" style="width: 450px; margin: 0 auto; text-align: center;">
          <div style="padding-bottom: 0%; font-size: 16pt;">
            <strong>Your BMI: </strong> {{ bmi }}
            <span class="tooltip-asterisk">*</span>
            <span class="tooltip-text">BMI is an approximate estimate of your fysical fitness. Note that individual condidtions may affect the accuracy of this estimate. BMI alone should not be used to estimate how healthy a person is.</span>
          </div>

          {% include "bmi_visual.html" %}
        </div>

        <div class="container mt-5" style="width: 450px; margin: 0 auto; text-align: center;">
          <div style="padding-bottom: 2%; font-size: 16pt;">
            <strong>RECOMENDED DAILY </strong>
          </div>

          {% if calories %}
            <div>
              <strong>Calories: </strong> {{ calories }} kcal
            </div>
          {% endif %}

          {% if protein is not none %}
            <div>
              <strong>Protein: </strong> {{ protein }} grams/day
            </div>
          {% endif %}

          {% if fat %}
            <div>
              <strong>Fat: </strong> {{ fat }} grams/day
            </div>
          {% endif %}

          {% if carbs %}
            <div>
              <strong>Carbs: </strong> {{ carbs }} grams/day
            </div>
          {% endif %}

          {% if water_intake %}
            <div>
              <strong>Water: </strong> {{ water_intake }} liter/day
            </div>
          {% endif %}

          {% if body_age %}
          <div>
            <strong>Body Age: </strong> {{ body_age }} years
          </div>
          {% endif %}
          

          <div class="mt-3">
            <h6 style="font-size: 0.8em;">That's about this many glasses of water:</h6>
            {% set glasses_count = (water_intake / 0.25) | round(0, 'ceil') | int %}
            <div 
              style="display: flex; flex-wrap: wrap; justify-content: left; width: 100%; margin-top: -3px; margin-bottom: -5px;"
              title="Each glass represents 0.25 liters of water â€” Total: {{ glasses_count }} glasses">
              {% for i in range(glasses_count) %}
                <div style="width: 12.5%; display: flex; justify-content: center; margin-top: -12px;">
                  <img src="{{ url_for('static', filename='glassofwater_color.png') }}" alt="Glass" style="width: 60px; height: 55px;">
                </div>
              {% endfor %}
            </div>
          </div>
        </div>

        {% if protein and fat and carbs %}
          <div class="mt-5" style="max-width: 500px; margin: auto;">
            <h5 class="text-center">Macronutrient Distribution</h5>
            <canvas id="macroChart"></canvas>
          </div>

          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script>
            const ctx = document.getElementById('macroChart').getContext('2d');
            const macroChart = new Chart(ctx, {
              type: 'pie',
              data: {
                labels: ['Protein', 'Fat', 'Carbs'],
                datasets: [{
                  data: [{{ protein }}, {{ fat }}, {{ carbs }}],
                  backgroundColor: ['#4caf50', '#ff9800', '#2196f3'],
                  borderWidth: 1
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: 'bottom'
                  },
                  tooltip: {
                    callbacks: {
                      label: function(context) {
                        let value = context.raw;
                        return `${context.label}: ${value}g`;
                      }
                    }
                  }
                }
              }
            });
          </script>
        {% endif %}
      {% endif %}

      {% if meal_plan %}
        <div class="container mt-5">
          <div style="padding-bottom: 0%; font-size: 16pt;">
            <h2>Suggested Meal Split</h2>
            <table class="table">
              <thead>
                <tr>
                  <th>Meal</th>
                  <th>Calories</th>
                  <th>Protein (g)</th>
                  <th>Fat (g)</th>
                  <th>Carbs (g)</th>
                </tr>
              </thead>
              <tbody>
                {% for meal, macros in meal_plan.items() %}
                  <tr>
                    <td>{{ meal }}</td>
                    <td>{{ macros.calories }}</td>
                    <td>{{ macros.protein }}</td>
                    <td>{{ macros.fat }}</td>
                    <td>{{ macros.carbs }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% endif %}


    </div>
  </div>
  
{% endblock %}
