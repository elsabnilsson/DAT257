{% extends "base.html" %}
{% block content %}
<style>
  .btn-calculate {
    background-color: #433118;
    color: white;
    width: 100%;
  }
</style>

<body style="background-color: #f7e5c1;">
  <div class="container mt-5" style="text-align: center;">
    <div class="row">
      <div class="position-relative text-center" style="display: inline-block;">
        <img src="{{ url_for('static', filename='logo.jpg') }}" alt="logo" class="col-md-2"
          style="display: block; margin-left: auto; margin-right: auto;">
      </div>
    </div>

    <div class="row">
      <div class="col-md-4" style="display: block; margin-left: auto; margin-right: auto;">
        <form onsubmit="loginUser(event)">
          <div class="mb-3">
            <input type="email" class="form-control" id="email" placeholder="Email" required />
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" id="password" placeholder="Password" required />
          </div>
          <div class="mb-4">
            <input type="submit" class="btn btn-calculate" value="Login" />
          </div>
        </form>

        <p>Don't have an account? <a href="{{ url_for('register') }}">Register here</a></p>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>

  <script>
    // ðŸ”§ Replace this with your actual Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDbRijonFCzWc5xWyWqPl8YAhZfYfIl0iU",
      authDomain: "dat257-a9920.firebaseapp.com",
      projectId: "dat257-a9920",
      storageBucket: "dat257-a9920.firebasestorage.app",
      messagingSenderId: "473370606734",
      appId: "1:473370606734:web:a54530028d7e8b8f845ddf",
      measurementId: "G-WB4E47RGFX"
    };

    firebase.initializeApp(firebaseConfig);

    function loginUser(e) {
      e.preventDefault();

      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(userCredential => userCredential.user.getIdToken())
        .then(idToken => {
          return fetch('/session-login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ idToken })
          });
        })
        .then(response => {
          if (response.ok) {
            window.location.href = "/profile";
          } else {
            alert("Login failed. Please try again.");
          }
        })
        .catch(error => {
          alert("Login error: " + error.message);
        });
    }
  </script>
</body>
{% endblock %}
